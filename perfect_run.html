<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The River Shade â€“ Perfect Run</title>
<link rel="stylesheet" href="style.css">
    <link href="mobile.css" rel="stylesheet"/>
<style>
body {
  background:#000;
  color:#ddd;
  font-family:'Georgia',serif;
  text-align:center;
  padding:2em;
}
.scene-text{max-width:760px;margin:0 auto;}
.choice{display:block;color:#9cf;text-decoration:none;margin:1em auto;max-width:200px;padding:0.5rem 1rem;border:1px solid #9cf;border-radius:8px;}
.choice:hover{opacity:.85;background:rgba(156,207,255,0.1);}
.line{opacity:0;transition:opacity 1.2s ease;margin:1em 0;}
.shade{color:#d77;}
.player{color:#eee;}
</style>
</head>
<body data-scene="perfect_run">
<main class="scene-text">
  <h1>The Confrontation</h1>
  <div id="dialogue"></div>
  <div id="choices" style="margin-top:1.2rem;"></div>
</main>

<script>
console.log("Perfect Run loaded");

function showLine(text, cls="player", delay=2000, onDone=null){
  const d=document.getElementById("dialogue");
  const p=document.createElement("p");
  p.className=`line ${cls}`;
  p.innerHTML=text;
  d.appendChild(p);
  setTimeout(()=>{
    p.style.opacity=1;
    console.log("Line shown:", text);
    if(onDone){
      setTimeout(onDone, delay);
    }
  },50);
}

function startScene(){
  console.log("Starting scene");
  const d=document.getElementById("dialogue");
  d.innerHTML="";
  showLine('Shade: "Why...why don\'t you listen to me?"',"shade", 2500, ()=>{
    showLine('Player: "I have listened to you..."',"player", 2500, ()=>{
      showLine('Shade: "No you haven\'t you are fighting me."',"shade", 2500, ()=>{
        const c=document.getElementById("choices");
        c.innerHTML="";
        const r=document.createElement("a");
        r.href="#";r.className="choice";r.textContent="(Resist)";
        r.onclick=(e)=>{e.preventDefault(); runResist();};
        const l=document.createElement("a");
        l.href="#";l.className="choice";l.textContent="(Listen)";
        l.onclick=(e)=>{e.preventDefault(); runListen();};
        c.appendChild(r);c.appendChild(l);
        console.log("Choices shown");
      });
    });
  });
}

function clearDialogue(){
  document.getElementById("dialogue").innerHTML="";
  document.getElementById("choices").innerHTML="";
}

function runResist(){
  console.log("Player chose Resist");
  
  // Unlock defiance achievement
  if (window.unlockAchievement) {
    window.unlockAchievement('defiance');
  }
  
  clearDialogue();
  showLine('Player: "I have listened to you for too long, you only tell me the negative...this is not protecting me..."',"player", 3000, ()=>{
    showLine('Shade: "It is protecting you...it is keeping the world away they will say so much worse look at you..."',"shade", 3000, ()=>{
      showLine('Player: (stares directly at the shade with acknowledgement) "I am looking at my self...and it is okay to be scared...but we can\'t hide."',"player", 3000, ()=>{
        transitionToEnd();
      });
    });
  });
}

function runListen(){
  console.log("Player chose Listen");
  
  // Unlock acceptance achievement
  if (window.unlockAchievement) {
    window.unlockAchievement('acceptance');
  }
  
  clearDialogue();
  showLine('Shade: "I am doing this for you...to protect you..."',"shade", 2500, ()=>{
    showLine('Player: "..."',"player", 2000, ()=>{
      showLine('Shade: "This keeps you safe it separates you from the vile world, here you exist out there you fail..."',"shade", 3000, ()=>{
        showLine('Player: "Not any longer...I won\'t be afraid...I accept this..."',"player", 3000, ()=>{
          transitionToEnd();
        });
      });
    });
  });
}

function transitionToEnd(){
  console.log("Transitioning to end");
  const c=document.getElementById("choices");
  c.innerHTML="";
  const next=document.createElement("a");
  next.href="perfect_end.html";
  next.className="choice";
  next.textContent="Continue...";
  c.appendChild(next);
}

document.addEventListener("DOMContentLoaded",()=>{
  console.log("DOM loaded");
  startScene();
});
</script>
</body>
</html>