<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The River Shade</title>
<link rel="stylesheet" href="style.css">
    <link href="mobile.css" rel="stylesheet"/>
<style>
/* === Title Overlay === */
#start-overlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, #111 10%, #000 90%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 9999;
  transition: opacity 3s ease;
}
#start-overlay h1 {
  color: #eee;
  font-size: 3em;
  letter-spacing: 0.08em;
  margin-bottom: 0.2em;
  text-shadow: 0 0 20px #446;
}
#start-overlay p {
  color: #888;
  margin-top: 0;
  font-size: 1.1em;
}
#start-btn {
  background: transparent;
  border: 1px solid #777;
  color: #ccc;
  font-size: 1.1em;
  padding: 0.6em 1.5em;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.4s ease;
  margin-top: 1.5em;
  font-family: 'Georgia', serif;
}
#start-btn:hover {
  color: #fff;
  border-color: #aaa;
  text-shadow: 0 0 10px #9cf;
}

/* === Main Content === */
.container {
  max-width: 760px;
  margin: 0 auto;
  padding: 2rem;
}

.header-title {
  text-align: center;
  font-size: 2.5rem;
  margin-bottom: 0;
  transition: all 1s ease;
}

.story-text {
  text-align: center;
  max-width: 700px;
  margin: 2rem auto;
  transition: all 1s ease;
}

.story-text.scrolled {
  margin-top: 1rem;
}

.story-text p {
  opacity: 0;
  transition: opacity 2s ease;
  line-height: 1.8;
}

#choices-section {
  margin-top: 3rem;
  border-top: 1px solid #333;
  padding-top: 2rem;
  opacity: 0;
  transition: opacity 2s ease;
}

.choice {
  display: block;
  color: #9cf;
  text-decoration: none;
  margin: 1em auto;
  padding: 0.6em 1.2em;
  border: 1px solid #9cf;
  border-radius: 8px;
  max-width: 300px;
  transition: all 0.3s;
  text-align: center;
}

.choice:hover {
  background: rgba(156,207,255,0.1);
}

/* === Inventory Box === */
#inventory-box {
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  background: rgba(0,0,0,0.6);
  border: 1px solid #888;
  padding: 0.5rem 1rem;
  font-family: monospace;
  color: #eee;
  border-radius: 8px;
  max-width: 250px;
  z-index: 1000;
}

/* === Reset Button === */
.reset-btn-top {
  position: fixed;
  top: 1rem;
  right: 1rem;
  background: rgba(80,0,0,0.6);
  border: 1px solid #600;
  color: #faa;
  padding: 0.4rem 0.8rem;
  border-radius: 6px;
  cursor: pointer;
  font-family: monospace;
  font-size: 0.85rem;
  z-index: 1000;
  transition: all 0.3s;
}
.reset-btn-top:hover {
  background: rgba(120,0,0,0.8);
  border-color: #900;
}

/* === Stats Button === */
.stats-btn-top {
  position: fixed;
  top: 1rem;
  right: 11rem;
  background: rgba(60,80,120,0.6);
  border: 1px solid rgba(156,207,255,0.3);
  color: #9cf;
  padding: 0.4rem 0.8rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1.2rem;
  z-index: 1000;
  transition: all 0.3s;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
}
.stats-btn-top:hover {
  background: rgba(80,100,140,0.8);
  border-color: #9cf;
  box-shadow: 0 0 15px rgba(156,207,255,0.4);
}

/* === Fade Overlay === */
.shade-fade {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.95) 90%);
  opacity: 0;
  transition: opacity 2s ease;
  pointer-events: none;
  z-index: 9998;
}
.shade-fade.active {
  opacity: 1;
}

/* === Perfect Path Link === */
#perfectPathLink {
  background: linear-gradient(135deg, rgba(60,80,120,0.2), rgba(40,60,100,0.3));
  border: 1px solid #69a;
  box-shadow: 0 0 15px rgba(100,150,200,0.3);
  animation: perfectPulse 3s infinite;
}
@keyframes perfectPulse {
  0%, 100% { box-shadow: 0 0 15px rgba(100,150,200,0.3); }
  50% { box-shadow: 0 0 25px rgba(100,150,200,0.5); }
}

footer {
  text-align: center;
  margin-top: 3rem;
  color: #666;
  font-style: italic;
  font-size: 0.9em;
}
</style>
</head>

<body data-scene="index" class="index-page">
  <!-- === Title Screen Overlay === -->
  <div id="start-overlay">
    <h1>The River Shade</h1>
    <p>by Bill Miller</p>
    <button id="start-btn">Begin</button>
  </div>

  <!-- Fade overlay -->
  <div class="shade-fade" id="overlay"></div>

  <!-- Reset Player Button -->
  <button class="reset-btn-top" id="resetBtn">‚ü≥ Reset Player</button>
  
  <!-- Stats Button -->
  <a href="stats.html" class="stats-btn-top" title="View Statistics">üìä</a>

  <!-- Main content -->
  <main class="scene-text fade-in container" style="display:none;">
    <h1 class="header-title">The River Shade</h1>
    
    <div class="story-text" id="storyText">
      <p id="line1">You wake standing upright, boots sunk in wet earth you don't remember crossing.</p>
      
      <p id="line2">The fog moves wrong here‚Äîcircling, patient, as though it's been waiting. Three paths split the darkness ahead, each one pulling at something beneath your ribs.</p>
      
      <p id="line3">You've been here before. Or you will be again. The distinction doesn't matter to the river.</p>
      
      <p id="line4" style="color:#9ab; font-style:italic;">The mist whispers: <em>"Choose. You always do. You always will."</em></p>
    </div>

    <div id="choices-section">
      <a class="choice" href="town.html">üèôÔ∏è Toward the Town</a>
      <a class="choice" href="bridge.html" id="bridgeLink">üåâ Toward the Bridge</a>
      <a class="choice" href="riverbank.html">üåä Toward the Riverbank</a>
    </div>
  </main>

  <footer class="hint">Behind you, footsteps echo where you left none.</footer>

  <div id="inventory-box"></div>

  <script src="layout_cleanup.js"></script>
<script src="achievements.js"></script>
<script src="item-examination.js"></script>

  <!-- ==================== RESET PLAYER ==================== -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("resetBtn");
    if (!btn) return;

    btn.addEventListener("click", (e) => {
      e.preventDefault();
      if (!confirm("Completely forget everything and begin anew?")) return;

      const overlay = document.getElementById("overlay");
      if (overlay) overlay.classList.add("active");

      setTimeout(() => {
        try { 
          localStorage.clear(); 
        } catch (err) {
          console.warn("Could not clear storage:", err);
        }
        window.location.href = "index.html?reset=" + Date.now();
      }, 1000);
    });
  });
  </script>

  <!-- ==================== PERFECT PATH UNLOCK ==================== -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    try {
      const perfectUnlocked = localStorage.getItem("perfectUnlocked") === "true";
      
      if (perfectUnlocked) {
        const choicesSection = document.getElementById("choices-section");
        if (choicesSection && !document.getElementById("perfectPathLink")) {
          const perfect = document.createElement("a");
          perfect.className = "choice";
          perfect.id = "perfectPathLink";
          perfect.href = "#";
          perfect.innerHTML = "üåë Follow the Memory";
          
          // Handle transition to Perfect Path
          perfect.addEventListener("click", (e) => {
            e.preventDefault();
            
            console.log("Entering Perfect Path - inventory already cleared");
            
            // Ensure inventory is empty
            localStorage.setItem("inventory", "[]");
            
            // Set active flag
            localStorage.setItem("perfectPathActive", "true");
            
            // Fade transition
            const overlay = document.getElementById("overlay");
            if (overlay) overlay.classList.add("active");
            
            setTimeout(() => {
              window.location.href = "perfect_path.html";
            }, 1500);
          });
          
          choicesSection.appendChild(perfect);
          
          // Show hint
          const hint = document.createElement("p");
          hint.style.textAlign = "center";
          hint.style.color = "#8ab";
          hint.style.fontStyle = "italic";
          hint.style.marginTop = "2rem";
          hint.innerHTML = "<em>The river remembers what you've forgotten...</em>";
          choicesSection.appendChild(hint);
        }
      }
    } catch (e) {
      console.warn("Perfect Path check failed:", e);
    }
  });
  </script>

  <!-- ==================== INVENTORY DISPLAY ==================== -->
  <script>
  function refreshInventoryBoxSafe() {
    const box = document.getElementById("inventory-box");
    if (!box) return;
    
    try {
      const inv = JSON.parse(localStorage.getItem("inventory") || "[]");
      const displayItems = inv.map(item => {
        if (typeof item === 'string') return item;
        if (item && item.name) return item.name;
        return String(item);
      });
      
      box.innerHTML = "<strong>Inventory</strong><br>" + 
        (displayItems.length ? displayItems.join("<br>") : "(empty)");
    } catch(e) {
      box.innerHTML = "<strong>Inventory</strong><br>(empty)";
    }
  }
  
  document.addEventListener("DOMContentLoaded", refreshInventoryBoxSafe);
  </script>

  <!-- ==================== TITLE SCREEN FADE ==================== -->
<!-- Find this section in index.html (around line 380) and REPLACE it with this: -->

<script>
document.addEventListener("DOMContentLoaded", () => {
  const overlayStart = document.getElementById("start-overlay");
  const mainContent = document.querySelector("main");
  const startBtn = document.getElementById("start-btn");

  if (!overlayStart || !mainContent || !startBtn) return;

  // Check if this is first play or a reset
  const hasPlayed = localStorage.getItem("hasPlayed") === "true";
  const isReset = window.location.search.includes("reset=");
  
  if (hasPlayed && !isReset) {
    // Skip intro - go straight to crossroads
    overlayStart.style.display = "none";
    mainContent.style.display = "block";
    
    // Hide intro text, show only choices
    document.getElementById("storyText").style.display = "none";
    document.getElementById("choices-section").style.opacity = "1";
    
    refreshInventoryBoxSafe();
  } else {
    // First play or reset - show full intro
    startBtn.addEventListener("click", () => {
      overlayStart.style.opacity = "0";
      
      setTimeout(() => {
        overlayStart.style.display = "none";
        mainContent.style.display = "block";
        
        // Mark as played
        localStorage.setItem("hasPlayed", "true");
        
        refreshInventoryBoxSafe();
        
        // Fade in story paragraphs one by one
        setTimeout(() => document.getElementById("line1").style.opacity = "1", 300);
        setTimeout(() => document.getElementById("line2").style.opacity = "1", 2200);
        setTimeout(() => document.getElementById("line3").style.opacity = "1", 4100);
        setTimeout(() => document.getElementById("line4").style.opacity = "1", 6000);
        
        // Show choices after all text has appeared
        setTimeout(() => {
          document.getElementById("choices-section").style.opacity = "1";
        }, 8000);
        
      }, 2000);
    });
  }
});
</script>

  <!-- ==================== BRIDGE FLAG SETUP ==================== -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const bridgeLink = document.getElementById("bridgeLink");
    if (bridgeLink) {
      bridgeLink.addEventListener("click", (e) => {
        try {
          const flags = JSON.parse(localStorage.getItem('rflags') || '{}');
          flags.crossedBridge = true;
          localStorage.setItem('rflags', JSON.stringify(flags));
        } catch(err) {
          console.warn("Could not set bridge flag:", err);
        }
      });
    }
  });
  </script>
/* =========================================================
   RESET BUTTON FIX - Add to every HTML page
   Place this BEFORE the closing </body> tag
   ========================================================= */

<script>
// === Universal Reset Player Button ===
document.addEventListener("DOMContentLoaded", () => {
  const resetBtn = document.getElementById("resetBtn");
  if (!resetBtn) return;
  
  // Remove any existing event listeners by cloning
  const newResetBtn = resetBtn.cloneNode(true);
  resetBtn.parentNode.replaceChild(newResetBtn, resetBtn);
  
  // Add fresh click handler
  newResetBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    
    console.log("Reset button clicked");
    
    // Confirm with user
    const confirmed = confirm("Reset your entire journey? This will erase all progress, inventory, memories, and achievements.");
    
    if (!confirmed) {
      console.log("Reset cancelled by user");
      return;
    }
    
    console.log("User confirmed reset");
    
    // Show fade overlay
    let overlay = document.getElementById("overlay");
    if (!overlay) {
      overlay = document.createElement("div");
      overlay.className = "shade-fade";
      overlay.id = "overlay";
      document.body.appendChild(overlay);
    }
    overlay.classList.add("active");
    
    // Clear everything after a brief delay
    setTimeout(() => {
      try {
        // Clear all localStorage
        localStorage.clear();
        console.log("localStorage cleared");
        
        // Clear sessionStorage too
        sessionStorage.clear();
        console.log("sessionStorage cleared");
        
        // Redirect to index with cache-busting parameter
        const timestamp = Date.now();
        window.location.href = `index.html?reset=${timestamp}`;
      } catch (err) {
        console.error("Reset error:", err);
        alert("Error resetting game. Please try refreshing the page manually.");
      }
    }, 1000);
  });
  
  console.log("Reset button initialized");
});
</script>
</body>
</html>
